<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Battle of the Elements</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="icon"
      href="https://alice-ji.github.io/Gacha/assets/favicon.png"
      type="image/png"
    />
    <style>
      .flex-break {
        flex-basis: 100%;
        height: 0;
      }
    </style>
  </head>
  <body>
    <h1>Your Collection</h1>
    <div id="collection" class="collection-grid"></div>
    <a href="index.html" class="btn back-btn">Menu</a>

    <script src="js/cards.js"></script>
    <script>
      let player = JSON.parse(localStorage.getItem("player")) || {
        cards: [],
      };
      let collectionDiv = document.getElementById("collection");

      // Count how many of each card the player owns
      let counts = {};
      player.cards.forEach((card) => {
        counts[card.name] = (counts[card.name] || 0) + 1;
      });

      let rareBreakAdded = false;
      let legendaryBreakAdded = false;

      cards.forEach((cardDef) => {
        // Add break only for the FIRST rare and FIRST legendary
        if (cardDef.rarity === "rare" && !rareBreakAdded) {
          let breakEl = document.createElement("div");
          breakEl.className = "flex-break";
          collectionDiv.appendChild(breakEl);
          rareBreakAdded = true;
        }
        if (cardDef.rarity === "legendary" && !legendaryBreakAdded) {
          let breakEl = document.createElement("div");
          breakEl.className = "flex-break";
          collectionDiv.appendChild(breakEl);
          legendaryBreakAdded = true;
        }

        let owned = counts[cardDef.name] || 0;
        let cardEl = document.createElement("div");
        cardEl.className = `card ${cardDef.rarity}`;

        if (owned > 0) {
          cardEl.innerHTML = `
    <img src="${cardDef.img}" alt="${cardDef.name}" class="card-img">
    <div class="rarity">${cardDef.rarity}</div>
    <div>BP: ${cardDef.power}</div>
    ${owned > 1 ? `<div class="count-badge">x${owned}</div>` : ""}
  `;
        } else {
          cardEl.classList.add("locked");
          cardEl.innerHTML = `
    <div class="locked-overlay">
      <img src="${cardDef.img}" alt="Locked" class="card-img locked-img">
    </div>
    <div class="name">???</div>
  `;
        }

        collectionDiv.appendChild(cardEl);
      });
    </script>
  </body>
</html>
